(function(e,t){e.Epoxy=e.Epoxy||{};var n,r=e.Epoxy.Model=e.Model.extend({_super:function(t,n){return e.Model.prototype[t].apply(this,n)},constructor:function(){this.obs={},this._super("constructor",arguments),this._init=!0,this.observables&&t.each(this.observables,function(e,t){this.addObservable(t,e)},this),this.computeds&&t.each(this.computeds,function(e,t){this.addComputed(t,e)},this),t.each(this.obs,function(e,t){e.init()}),delete this._init},get:function(e){return n&&n.push([e,this]),this.hasObservable(e)?this.obs[e].get():this._super("get",arguments)},getCopy:function(e){var n=this.get(e);return t.isArray(n)?n.slice():t.isObject(n)?t.clone(n):n},set:function(e,t,n){var r=e;return r&&typeof r!="object"?(r={},r[e]=t):n=t,n=n||{},n.unset||(r=this._deepset(r,{},[])),this._super("set",[r,n])},_deepset:function(e,n,r){for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];if(this.hasObservable(i)){if(!(!r.length||t.indexOf(r,i)<0))throw"Recursive setter: "+r.join(" > ");s=this.obs[i].set(s),s&&typeof s=="object"&&(n=this._deepset(s,n,r.slice().concat([i])))}else n[i]=s}return n},destroy:function(){return this.clearObservables(),this._super("destroy",arguments)},addObservable:function(e,t){this.removeObservable(e),this.obs[e]=new i(this,e,{value:t})},addComputed:function(e,n,r){this.removeObservable(e);var s=n;if(t.isFunction(n)){var o=2;s={},s._get=n,t.isFunction(r)&&(s._set=r,o++),s.deps=Array.prototype.slice.call(arguments,o)}this.obs[e]=new i(this,e,s)},hasObservable:function(e){return this.obs.hasOwnProperty(e)},removeObservable:function(e){this.hasObservable(e)&&(this.obs[e].dispose(),delete this.obs[e])},clearObservables:function(){for(var e in this.obs)this.removeObservable(e)},modifyArray:function(e,n){var r=this.get(e),i=Array.prototype;if(t.isArray(r)&&t.isFunction(i[n])){var s=i.slice.call(arguments,2),o=i[n].apply(r,s);return this.trigger("change change:"+e),o}return null},modifyObject:function(e,n,r){var i=this.get(e),s=!1;return t.isObject(i)?(t.isUndefined(r)&&i.hasOwnProperty(n)?(delete i[n],s=!0):i[n]!==r&&(i[n]=r,s=!0),s&&this.trigger("change change:"+e),i):null}}),i=function(e,n,r){r=r||{},r.get&&t.isFunction(r.get)&&(r._get=r.get),r.set&&t.isFunction(r.set)&&(r._set=r.set),delete r.get,delete r.set,t.extend(this,r),this.model=e,this.name=n,this.deps=this.deps||[],e._init||this.init()};t.extend(i.prototype,e.Events,{init:function(){n=this.deps,this.get(!0),n=null;if(this.deps.length){var e={};t.each(this.deps,function(n){var r=this.model;t.isArray(n)&&(r=n[1],n=n[0]),!n.indexOf("change:")||(n="change:"+n),e.hasOwnProperty(n)?t.contains(e[n],r)||e[n].push(r):e[n]=[r]},this),t.each(e,function(e,n){for(var r=0,i=e.length;r<i;r++)this.listenTo(e[r],n,t.bind(this.get,this,!0))},this)}},get:function(e){if(e===!0&&this._get){var t=this._get.call(this.model);this.change(t)}return this.value},set:function(e){if(this._get){if(this._set)return this._set.apply(this.model,arguments);throw"Cannot set read-only computed observable."}return this.change(e),null},fire:function(){this.model.trigger("change change:"+this.name)},change:function(e){t.isEqual(e,this.value)||(this.value=e,this.fire())},dispose:function(){this.stopListening(),this.off(),this.model=this.value=null}})})(Backbone,_);