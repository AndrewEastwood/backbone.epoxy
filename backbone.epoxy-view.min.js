(function(){function i(e){return e instanceof t.Model}function s(e){return e instanceof t.Collection}function o(e,t,o){if(!e)return;n.isFunction(e)&&(e=e());if(i(e)){var u=o?o+"_":"",a=n.extend({},e.attributes,e.obs||{});t["$"+(o||"model")]=function(){return r&&r.push([e,"change"]),e},n.each(a,function(i,s){t[u+s]=function(t){return r&&r.push([e,"change:"+s]),n.isUndefined(t)?e.get(s):n.isObject(t)&&!n.isArray(t)?e.set(t):e.set(s,t)}})}else s(e)&&(t["$"+(o||"collection")]=function(){return r&&r.push([e,"reset add remove sort"]),e});return e}function a(e){return n.isFunction(e)?e():(n.isObject(e)&&(e=n.isArray(e)?e.slice():n.clone(e),n.each(e,function(t,n){e[n]=a(t)})),e)}var e=this,t=e.Backbone,n=e._;t.Epoxy=t.Epoxy||{};var r,u=t.Epoxy.View=t.View.extend({constructor:function(e){this._bind=[],t.View.prototype.constructor.apply(this,arguments),this.applyBindings()},bindings:"data-bind",applyBindings:function(){function s(t,n,s){try{e._bind.push(new c(t,n,i,r))}catch(o){throw'Error parsing bindings for "'+s+'" >> '+o}}this.removeBindings();if(!this.model&&!this.collection)return;var e=this,t=this.bindingSources,r=n.clone(f),i={};n.each(e.bindingHandlers||{},function(e,t){r[t]=n.isFunction(e)?{set:e}:e}),e.model=o(e.model,i),e.collection=o(e.collection,i),n.each(t,function(e,n){t[n]=o(e,i,n)});if(n.isObject(this.bindings))n.each(this.bindings,function(e,t){var n=this.$(t);this.$el.is(t)&&(n=n.add(this.$el)),n.length&&s(n,e,t)},this);else{var u=this.bindings,a="["+u+"]",l=this.$(a);this.$el.is(a)&&(l=l.add(this.$el)),l.each(function(e){e=$(this),s(e,e.attr(u),a)})}},removeBindings:function(){while(this._bind.length)this._bind.pop().dispose()},remove:function(){this.removeBindings(),t.View.prototype.remove.call(this)}}),f={attr:{set:function(e,t){e.attr(t)}},checked:{get:function(e,t){var r=!!e.prop("checked"),i=e.val();if(e.is(":radio"))return i;if(n.isArray(t)){t=t.slice();var s=n.indexOf(t,i);return r&&s<0?t.push(i):!r&&s>-1&&t.splice(s,1),t}return r},set:function(e,t){var r=!!t;e.is(":radio")?r=t==e.val():n.isArray(t)&&(r=n.contains(t,e.val())),e.prop("checked",r)}},classes:{set:function(e,t){n.each(t,function(t,n){e.toggleClass(n,!!t)})}},collection:{set:function(e,t,r){if(!s(t)||!n.isFunction(t.view))throw"Binding 'collection:' requires a Collection with a 'view' constructor.";var o=t.models,u=this.v,a;r=r||t;if(i(r))if(!u.hasOwnProperty(r.cid)){u[r.cid]=a=new t.view({model:r});var f=n.indexOf(o,r);e.children().length<f?e.eq(f).before(a.$el):e.append(a.$el)}else a=u[r.cid],a.remove(),delete u[r.cid];else if(s(r)){var l=n.every(o,function(e){return u.hasOwnProperty(e.cid)});e.hide(),l?t.each(function(t){e.append(u[t.cid].$el)}):(this.empty(),t.each(function(n){u[n.cid]=a=new t.view({model:n}),e.append(a.$el)})),e.show()}}},css:{set:function(e,t){e.css(t)}},disabled:{set:function(e,t){e.prop("disabled",!!t)}},enabled:{set:function(e,t){e.prop("disabled",!t)}},html:{set:function(e,t){e.html(t)}},text:{set:function(e,t){e.text(t)}},toggle:{set:function(e,t){e.toggle(!!t)}},value:{get:function(e){return e.val()},set:function(e,t){e.val(t)}}},l={all:function(){var e=arguments;return function(){var t=!0;for(var n=0,r=e.length;n<r;n++)a(e[n])||(t=!1);return t}},any:function(){var e=arguments;return function(){var t=!1;for(var n=0,r=e.length;n<r;n++)a(e[n])&&(t=!0);return t}},none:function(){var e=arguments;return function(){var t=!0;for(var n=0,r=e.length;n<r;n++)a(e[n])&&(t=!1);return t}},not:function(e){return function(){return!a(e)}},format:function(){var e=arguments;return function(){var t=a(e[0]);for(var n=1,r=e.length;n<r;n++)t=t.replace("$"+n,a(e[n]));return t}},select:function(){var e=arguments;return function(){var t=a(e[0]),n=a(e[1]),r=a(e[2]);return t?n:r}}},c=function(e,t,i,s){this.$el=e,this.v={};var o=this,u=e[0].tagName.toLowerCase(),f=u=="input"||u=="select"||u=="textarea",c=new Function("$o","$a","with($o){with($a){return{"+t+"}}}"),h=["change"];t=c(l,i),t.events&&(h=n.isArray(t.events)?n.union(h,t.events):h,delete t.events),this.events=n.map(h,function(e){return e+".epoxy"}).join(" "),n.each(t,function(e,t){if(!s.hasOwnProperty(t))throw"invalid binding => "+t;var i=s[t],u=[];r=u,i.set.call(o,o.$el,a(e)),r=null,f&&i.get&&n.isFunction(e)&&o.$el.on(o.events,function(){e(i.get.call(o,o.$el,a(e)))});if(u.length){var l=function(t){i.set.call(o,o.$el,a(e),t)};for(var c=0,h=u.length;c<h;c++)o.listenTo(u[c][0],u[c][1],l)}})};n.extend(c.prototype,t.Events,{empty:function(){for(var e in this.v)this.v.hasOwnProperty(e)&&(e.remove(),delete this.v[e])},dispose:function(){this.empty(),this.stopListening(),this.$el.off(this.events),this.$el=null}})}).call(this);