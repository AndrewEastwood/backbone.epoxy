(function(e,t){e.Epoxy={};var n=e.Epoxy.Model=e.Model.extend({_super:function(t,n){return e.Model.prototype[t].apply(this,n)},constructor:function(){this.obs={},this._super("constructor",arguments),this._init=!0,this.virtuals&&t.each(this.virtuals,function(e,t){this.addVirtual(t,e)},this),this.computeds&&t.each(this.computeds,function(e,t){this.addComputed(t,e)},this),t.each(this.obs,function(e,t){e.init()}),delete this._init},get:function(e){return n._map&&n._map.push([e,this]),this.hasVirtual(e)?this.obs[e].get():this._super("get",arguments)},set:function(e,t,n){var r=e;return r&&typeof r!="object"?(r={},r[e]=t):n=t,n=n||{},n.unset||(r=this._vset(r,{},[])),this._super("set",[r,n])},_vset:function(e,n,r){for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];if(this.hasVirtual(i)){if(!(!r.length||t.indexOf(r,i)<0))throw"Recursive setter: "+r.join(" > ");s=this.obs[i].set(s),s&&typeof s=="object"&&(n=this._vset(s,n,r.slice().concat([i])))}else n[i]=s}return n},destroy:function(){return this.clearVirtuals(),this._super("destroy",arguments)},addVirtual:function(e,t){this.removeVirtual(e),this.obs[e]=new n.VirtualProperty(this,e,{value:t})},addComputed:function(e,t,r){this.removeVirtual(e);var i=t;if(typeof t=="function"){var s=2;i={},i._get=t,typeof r=="function"&&(i._set=r,s++),i.deps=Array.prototype.slice.call(arguments,s)}this.obs[e]=new n.VirtualProperty(this,e,i)},removeVirtual:function(e){this.hasVirtual(e)&&(this.obs[e].dispose(),delete this.obs[e])},hasVirtual:function(e){return this.obs.hasOwnProperty(e)},clearVirtuals:function(){for(var e in this.obs)this.removeVirtual(e)}}),r=n.VirtualProperty=function(e,n,r){r=r||{},r.get&&typeof r.get=="function"&&(r._get=r.get),r.set&&typeof r.set=="function"&&(r._set=r.set),delete r.get,delete r.set,t.extend(this,r),this.model=e,this.name=n,this.deps=this.deps||[],e._init||this.init()};t.extend(r.prototype,e.Events,{dirty:!0,deps:undefined,value:undefined,previous:undefined,init:function(){n._map=this.deps,this.update(),n._map=null;if(this.deps.length){var e={};t.each(this.deps,function(n){var r=this.model;n instanceof Array&&(r=n[1],n=n[0]),!n.indexOf("change:")||(n="change:"+n),e.hasOwnProperty(n)?t.contains(e[n],r)||e[n].push(r):e[n]=[r]},this),t.each(e,function(e,t){for(var n=0,r=e.length;n<r;n++)this.listenTo(e[n],t,this.update)},this)}},get:function(){if(this.dirty&&this._get){var e=this._get.call(this.model);this.change(e)}return this.dirty=!1,this.value},set:function(e){if(this._get){if(this._set)return this._set.apply(this.model,arguments);throw"Cannot set read-only computed observable."}return this.change(e),null},update:function(){this.dirty=!0,this.get()},fire:function(){this.model.trigger("change change:"+this.name)},change:function(e){e!==this.value&&(this.previous=this.value,this.value=e,this.fire())},_ary:function(e,t){if(this.value instanceof Array){var n=Array.prototype[e].apply(this.value,t);this.fire()}},pop:function(){return this._ary("pop",arguments)},push:function(){return this._ary("push",arguments)},reverse:function(){return this._ary("reverse",arguments)},shift:function(){return this._ary("shift",arguments)},slice:function(){return this._ary("slice",arguments)},sort:function(){return this._ary("sort",arguments)},unshift:function(){return this._ary("unshift",arguments)},dispose:function(){this.stopListening(),this.off(),this.model=this.value=this.previous=null}}),e.Epoxy.defaultBindings={attr:{set:function(e,t){e.attr(t)}},checked:{get:function(e){return e.is(":radio")?e.val():!!e.prop("checked")},set:function(e,t){var n=e.is(":radio")?t==e.val():!!t;e.prop("checked",n)}},className:{set:function(e,n){t.each(n,function(t,n){e.toggleClass(n,!!t)})}},css:{set:function(e,t){e.css(t)}},disabled:{set:function(e,t){e.prop("disabled",!!t)}},enabled:{set:function(e,t){e.prop("disabled",!t)}},html:{set:function(e,t){e.html(t)}},text:{set:function(e,t){e.text(t)}},toggle:{set:function(e,t){e.toggle(!!t)}},value:{get:function(e){return e.val()},set:function(e,t){e.val(t)}}};var i=e.Epoxy.View=e.View.extend({constructor:function(t){this._xv=[],e.View.prototype.constructor.call(this,arguments)},bindView:function(){function u(e,t,u){try{o._xv.push(new i.Binding(e,t,r,n,s))}catch(a){throw'Error parsing bindings for "'+u+'" >> '+a}}this.unbindView();if(!this.model||!this.bindings)return;var n=t.extend(this.operators||{},e.Epoxy.defaultBindings),r={},s=this.model,o=this;t.each(t.extend({},s.attributes,s.obs||{}),function(e,t){r[t]=function(e){return i._map&&i._map.push("change:"+t),e!==void 0?e&&typeof e=="object"?s.set(e):s.set(t,e):s.get(t)}});if(this.bindings&&typeof this.bindings=="object")t.each(this.bindings,function(e,t){var n=this.$(t);this.$el.is(t)&&(n=n.add(this.$el)),n.length&&u(n,e,t)},this);else{var a=this.bindings,f="["+a+"]",l=this.$(f);this.$el.is(f)&&(l=l.add(this.$el)),l.each(function(e){e=$(this),u(e,e.attr(a),f)})}},unbindView:function(){while(this._xv.length)this._xv.pop().dispose()},remove:function(){this.unbindView(),e.View.prototype.remove.call(this)}}),s=i.Binding=function(e,n,r,s,o){this.$el=e,this.accessors=r,this.parser=new Function("$context","with($context){return{"+n+"}}"),this.parse();var u=this,a=e[0].tagName.toLowerCase(),f=a=="input"||a=="select"||a=="textarea";t.each(u.bindings,function(e,t){if(!s.hasOwnProperty(t))throw"invalid binding => "+n;var n=s[t],r=[];i._map=r,n.set.call(u,u.$el,u.read(e)),i._map=null,f&&n.get&&typeof e=="function"&&u.$el.on(u.events,function(){e(n.get.call(u,u.$el))}),r.length&&u.listenTo(o,r.join(" "),function(){n.set.call(u,u.$el,u.read(e))})})};t.extend(s.prototype,e.Events,{dirty:!1,events:"change.epoxy",accessors:{},bindings:{},parse:function(e){var n=this.bindings=this.parser(this.accessors);if(n.events){var r=n.events;r instanceof Array&&(t.indexOf(r,"change")<0&&r.push("change"),this.events=t.map(r,function(e){return e+".epoxy"}).join(" ")),delete n.events}if(e)return n[e]},read:function(e){var n=typeof e;return n=="function"?e():n&&n=="object"?(e=t.clone(e),t.each(e,function(t,n){e[n]=this.read(t)},this),e):e},dispose:function(){this.stopListening(),this.$el.off(this.events),this.$el=this.accessors=this.parser=null}})})(Backbone,_);