// Backbone.Epoxy 0.11.1
// (c) 2013 Greg MacWilliam
// Freely distributed under the MIT license
// http://epoxyjs.org
(function(t,e){var n="backbone",i="underscore";"undefined"!=typeof exports?module.exports=e(require(i),require(n)):"function"==typeof define&&define.amd?define([i,n],e):e(t._,t.Backbone)})(this,function(t,e){function n(t){return function(e,n,i){return t.prototype[n].apply(e,i)}}function i(e,n,s,r){for(var o in n)if(n.hasOwnProperty(o)){var c=n[o];if(e.hasObservable(o)){if(r.length&&!(0>t.indexOf(r,o)))throw"Recursive setter: "+r.join(" > ");c=e.obs[o].set(c),c&&w(c)&&(s=i(e,c,s,r.slice().concat([o])))}else s[o]=c}return s}function s(e){return O(e)?e.slice():w(e)?t.clone(e):e}function r(e,n,i){i=i||{},i.get&&y(i.get)&&(i._get=i.get),i.set&&y(i.set)&&(i._set=i.set),delete i.get,delete i.set,t.extend(this,i),this.model=e,this.name=n,this.deps=this.deps||[],e._init||this.init()}function o(e){return y(e)?e():(w(e)&&(e=O(e)?e.slice():t.clone(e),t.each(e,function(t,n){e[n]=o(t)})),e)}function c(t){return y(t)?{set:t}:t}function u(t){return function(){var e=arguments;return function(n){return t.apply(this,a(e,n))}}}function a(t,e){if(e)throw"binding error: filtered values are read-only.";for(var n=[],i=0,s=t.length;s>i;i++)n.push(o(t[i]));return n}function l(e,n,i){if(e){if(y(e)&&(e=e()),x(e)){var s=i?i+"_":"";n["$"+(i||"model")]=function(){return q&&q.push([e,"change"]),e},t.each(e.toJSON({obs:!0}),function(t,i){n[s+i]=function(t){return h(e,i,t)}})}else _(e)&&(n["$"+(i||"collection")]=function(){return q&&q.push([e,"reset add remove sort update"]),e});return e}}function h(t,e,n){return q&&q.push([t,"change:"+e]),m(n)?t.get(e):w(n)&&!O(n)?t.set(n):t.set(e,n)}function f(t,e){var n=t.$(e);return t.$el.is(e)&&(n=n.add(t.$el)),n}function d(e,n,i,s,r,o){try{var c=Function("$f","$c","with($f){with($c){return{"+i+"}}}")(o,s)}catch(u){throw"Error parsing bindings: "+i}var a=t.map(t.union(c.events||[],["change"]),function(t){return t+".epoxy"}).join(" ");t.each(c,function(t,i){r.hasOwnProperty(i)&&e._bind.push(new v(n,r[i],t,a,s,c))})}function v(e,n,i,s,r,c){var u=this,a=e[0].tagName.toLowerCase(),l="input"==a||"select"==a||"textarea"==a,h=[],f=function(t){u.set(u.$el,o(i),t)};if(u.$el=e,u.evt=s,t.extend(u,n),i=u.init(u.$el,o(i),r,c)||i,q=h,f(),q=null,l&&n.get&&y(i)&&u.$el.on(s,function(){i(u.get(u.$el,o(i)))}),h.length)for(var d=0,v=h.length;v>d;d++)u.listenTo(h[d][0],h[d][1],f)}var g,p=e.Epoxy={},b=Array.prototype,m=t.isUndefined,y=t.isFunction,w=t.isObject,O=t.isArray,x=function(t){return t instanceof e.Model},_=function(t){return t instanceof e.Collection},P=function(){},C=n(e.Model);p.Model=e.Model.extend({constructor:function(){this.obs={},C(this,"constructor",arguments),this._init=!0,this.observableDefaults&&t.each(this.observableDefaults,function(t,e){this.addObservable(e,y(t)?t():s(t))},this),this.computeds&&t.each(this.computeds,function(t,e){this.addComputed(e,t)},this),t.each(this.obs,function(t){t.init()}),delete this._init},get:function(t){return g&&g.push([t,this]),this.hasObservable(t)?this.obs[t].get():C(this,"get",arguments)},getCopy:function(t){return s(this.get(t))},set:function(t,e,n){var s=t;return s&&!w(s)?(s={},s[t]=e):n=e,n=n||{},n.unset||(s=i(this,s,{},[])),C(this,"set",[s,n])},toJSON:function(e){var n=C(this,"toJSON",arguments);return e&&e.obs&&t.each(this.obs,function(t,e){n[e]=t.value}),n},destroy:function(){return this.clearObservables(),C(this,"destroy",arguments)},addObservable:function(t,e){return this.removeObservable(t),this.obs[t]=new r(this,t,{value:e}),this},addComputed:function(t,e,n){this.removeObservable(t);var i=e;if(y(e)){var s=2;i={},i._get=e,y(n)&&(i._set=n,s++),i.deps=b.slice.call(arguments,s)}return this.obs[t]=new r(this,t,i),this},hasObservable:function(t){return this.obs.hasOwnProperty(t)},removeObservable:function(t){return this.hasObservable(t)&&(this.obs[t].dispose(),delete this.obs[t]),this},clearObservables:function(){for(var t in this.obs)this.removeObservable(t);return this},modifyArray:function(t,e){var n=this.get(t);if(O(n)&&y(b[e])){var i=b.slice.call(arguments,2),s=b[e].apply(n,i);return this.trigger("change change:"+t),s}return null},modifyObject:function(t,e,n){var i=this.get(t),s=!1;return w(i)?(m(n)&&i.hasOwnProperty(e)?(delete i[e],s=!0):i[e]!==n&&(i[e]=n,s=!0),s&&this.trigger("change change:"+t),i):null}}),t.extend(r.prototype,e.Events,{init:function(){if(g=this.deps,this.get(!0),g=null,this.deps.length){var e={};t.each(this.deps,function(n){var i=this.model;O(n)&&(i=n[1],n=n[0]),n.indexOf("change:")&&(n="change:"+n),e.hasOwnProperty(n)?t.contains(e[n],i)||e[n].push(i):e[n]=[i]},this),t.each(e,function(e,n){for(var i=0,s=e.length;s>i;i++)this.listenTo(e[i],n,t.bind(this.get,this,!0))},this)}},get:function(t){if(t===!0&&this._get){var e=this._get.call(this.model);this.change(e)}return this.value},set:function(t){if(this._get){if(this._set)return this._set.apply(this.model,arguments);throw"Cannot set read-only computed observable."}return this.change(t),null},fire:function(){this.model.trigger("change change:"+this.name)},change:function(e){t.isEqual(e,this.value)||(this.value=e,this.fire())},dispose:function(){this.stopListening(),this.off(),this.model=this.value=null}});var E={optionText:"label",optionValue:"value"},B={attr:{set:function(t,e){t.attr(e)}},checked:{get:function(e,n){var i=!!e.prop("checked"),s=e.val();if(e.is(":radio"))return s;if(O(n)){n=n.slice();var r=t.indexOf(n,s);return i&&0>r?n.push(s):!i&&r>-1&&n.splice(r,1),n}return i},set:function(e,n){var i=!!n;e.is(":radio")?i=n==e.val():O(n)&&(i=t.contains(n,e.val())),e.prop("checked",i)}},classes:{set:function(e,n){t.each(n,function(t,n){e.toggleClass(n,!!t)})}},collection:{init:function(t,e){if(!_(e)||!y(e.view))throw"Binding 'collection' requires a Collection with a 'view' constructor.";this.v={}},set:function(e,n,i){var s,r=n.models,o=this.v;if(i=i||n,x(i))if(o.hasOwnProperty(i.cid))s=o[i.cid],s.remove(),delete o[i.cid];else{o[i.cid]=s=new n.view({model:i});var c=t.indexOf(r,i);c>e.children().length?e.eq(c).before(s.$el):e.append(s.$el)}else if(_(i)){var u=r.length&&t.every(r,function(t){return o.hasOwnProperty(t.cid)});e.hide(),u?n.each(function(t){e.append(o[t.cid].$el)}):(this.clean(),n.each(function(t){o[t.cid]=s=new n.view({model:t}),e.append(s.$el)})),e.show()}},clean:function(){for(var t in this.v)this.v.hasOwnProperty(t)&&(this.v[t].remove(),delete this.v[t])}},css:{set:function(t,e){t.css(e)}},disabled:{set:function(t,e){t.prop("disabled",!!e)}},enabled:{set:function(t,e){t.prop("disabled",!e)}},html:{set:function(t,e){t.html(e)}},options:{init:function(t,e,n,i){this.e=i.optionsEmpty,this.d=i.optionsDefault,this.v=i.value},set:function(e,n){var i=this,s=o(i.e),r=o(i.d),c=o(i.v),u=O(c)?c:[c],a=_(n)?n.models:n,l=a.length,h=!0,f="";l||r||!s?(r&&(a=[r].concat(a)),t.each(a,function(t){f+=i.opt(t,l,u)})):(f+=i.opt(s,l,u),h=!1),e.html(f).prop("disabled",!h);var d=e.val();i.v&&!t.isEqual(c,d)&&i.v(d)},opt:function(e,n,i){var s=e,r=e,o=E.optionText,c=E.optionValue;w(e)&&(s=x(e)?e.get(o):e[o],r=x(e)?e.get(c):e[c]);var u=!n||t.contains(i,r)?"' selected='selected'>":"'>";return"<option value='"+r+u+s+"</option>"},clean:function(){this.d=this.e=this.v=null}},template:{init:function(e,n,i){var s=e.find("script,template");return this.tmpl=t.template(s.length?s.html():e.html()),O(n)?t.pick(i,n):void 0},set:function(t,e){e=x(e)?e.toJSON({obs:!0}):e,t.html(this.tmpl(e))},clean:function(){this.tmpl=null}},text:{set:function(t,e){t.text(e)}},toggle:{set:function(t,e){t.toggle(!!e)}},value:{get:function(t){return t.val()},set:function(t,e){try{t.val()!=e&&t.val(e)}catch(n){}}}},k={all:u(function(){for(var t=arguments,e=0,n=t.length;n>e;e++)if(!t[e])return!1;return!0}),any:u(function(){for(var t=arguments,e=0,n=t.length;n>e;e++)if(t[e])return!0;return!1}),length:u(function(t){return t.length||0}),none:u(function(){for(var t=arguments,e=0,n=t.length;n>e;e++)if(t[e])return!1;return!0}),not:u(function(t){return!t}),format:u(function(t){for(var e=arguments,n=1,i=e.length;i>n;n++)t=t.replace(RegExp("\\$"+n,"g"),e[n]);return t}),select:u(function(t,e,n){return t?e:n})};p.binding={addHandler:function(t,e){B[t]=c(e)},addFilter:function(t,e){k[t]=u(e)},config:function(e){t.extend(E,e)}};var q,S=n(e.View);return p.View=e.View.extend({constructor:function(){this._bind=[],S(this,"constructor",arguments),this.applyBindings()},bindings:"data-bind",applyBindings:function(){if(this.removeBindings(),this.model||this.collection||this.bindingSources){var e=this,n=e.bindingSources,i=e.bindings,s=t.clone(B),r=t.clone(k),o=e._ctx={};t.each(t.result(e,"bindingHandlers")||{},function(t,e){s[e]=c(t)}),t.each(t.result(e,"bindingFilters")||{},function(t,e){r[e]=u(t)}),e.model=l(e.model,o),e.collection=l(e.collection,o),t.each(n,function(t,e){n[e]=l(t,o,e)}),t.each(t.result(e,"computeds")||{},function(t,n){t.id=n,o[n]=function(n){t.call(e,n)}}),w(i)?t.each(i,function(t,n){var i=f(e,n);i.length&&d(e,i,t,o,s,r)}):f(e,"["+i+"]").each(function(){var t=$(this);d(e,t,t.attr(i),o,s,r)})}},get:function(t){if(arguments.callee.caller.id===t)throw"recursive access error: "+t;return this._ctx&&this._ctx.hasOwnProperty(t)?o(this._ctx[t]):null},removeBindings:function(){for(this._ctx=null;this._bind.length;)this._bind.pop().dispose()},remove:function(){this.removeBindings(),S(this,"remove")}}),t.extend(v.prototype,e.Events,{init:P,get:P,set:P,clean:P,dispose:function(){this.clean(),this.stopListening(),this.$el.off(this.evt),this.$el=null}}),p});