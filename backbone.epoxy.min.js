(function(){var e=this,t=e.Backbone,n=e._;t.Epoxy=t.Epoxy||{};var r,i=t.Epoxy.Model=t.Model.extend({_super:function(e,n){return t.Model.prototype[e].apply(this,n)},constructor:function(){this.obs={},this._super("constructor",arguments),this._init=!0,this.observableDefaults&&n.each(this.observableDefaults,function(e,t){this.addObservable(t,n.isFunction(e)?e():e)},this),this.computeds&&n.each(this.computeds,function(e,t){this.addComputed(t,e)},this),n.each(this.obs,function(e,t){e.init()}),delete this._init},get:function(e){return r&&r.push([e,this]),this.hasObservable(e)?this.obs[e].get():this._super("get",arguments)},getCopy:function(e){var t=this.get(e);return n.isArray(t)?t.slice():n.isObject(t)?n.clone(t):t},set:function(e,t,r){var i=e;return i&&!n.isObject(i)?(i={},i[e]=t):r=t,r=r||{},r.unset||(i=this._deepset(i,{},[])),this._super("set",[i,r])},_deepset:function(e,t,r){for(var i in e)if(e.hasOwnProperty(i)){var s=e[i];if(this.hasObservable(i)){if(!(!r.length||n.indexOf(r,i)<0))throw"Recursive setter: "+r.join(" > ");s=this.obs[i].set(s),s&&n.isObject(s)&&(t=this._deepset(s,t,r.slice().concat([i])))}else t[i]=s}return t},destroy:function(){return this.clearObservables(),this._super("destroy",arguments)},addObservable:function(e,t){this.removeObservable(e),this.obs[e]=new s(this,e,{value:t})},addComputed:function(e,t,r){this.removeObservable(e);var i=t;if(n.isFunction(t)){var o=2;i={},i._get=t,n.isFunction(r)&&(i._set=r,o++),i.deps=Array.prototype.slice.call(arguments,o)}this.obs[e]=new s(this,e,i)},hasObservable:function(e){return this.obs.hasOwnProperty(e)},removeObservable:function(e){this.hasObservable(e)&&(this.obs[e].dispose(),delete this.obs[e])},clearObservables:function(){for(var e in this.obs)this.removeObservable(e)},modifyArray:function(e,t){var r=this.get(e),i=Array.prototype;if(n.isArray(r)&&n.isFunction(i[t])){var s=i.slice.call(arguments,2),o=i[t].apply(r,s);return this.trigger("change change:"+e),o}return null},modifyObject:function(e,t,r){var i=this.get(e),s=!1;return n.isObject(i)?(n.isUndefined(r)&&i.hasOwnProperty(t)?(delete i[t],s=!0):i[t]!==r&&(i[t]=r,s=!0),s&&this.trigger("change change:"+e),i):null}}),s=function(e,t,r){r=r||{},r.get&&n.isFunction(r.get)&&(r._get=r.get),r.set&&n.isFunction(r.set)&&(r._set=r.set),delete r.get,delete r.set,n.extend(this,r),this.model=e,this.name=t,this.deps=this.deps||[],e._init||this.init()};n.extend(s.prototype,t.Events,{init:function(){r=this.deps,this.get(!0),r=null;if(this.deps.length){var e={};n.each(this.deps,function(t){var r=this.model;n.isArray(t)&&(r=t[1],t=t[0]),!t.indexOf("change:")||(t="change:"+t),e.hasOwnProperty(t)?n.contains(e[t],r)||e[t].push(r):e[t]=[r]},this),n.each(e,function(e,t){for(var r=0,i=e.length;r<i;r++)this.listenTo(e[r],t,n.bind(this.get,this,!0))},this)}},get:function(e){if(e===!0&&this._get){var t=this._get.call(this.model);this.change(t)}return this.value},set:function(e){if(this._get){if(this._set)return this._set.apply(this.model,arguments);throw"Cannot set read-only computed observable."}return this.change(e),null},fire:function(){this.model.trigger("change change:"+this.name)},change:function(e){n.isEqual(e,this.value)||(this.value=e,this.fire())},dispose:function(){this.stopListening(),this.off(),this.model=this.value=null}})}).call(this),function(){function i(e,i,s){if(!e)return;n.isFunction(e)&&(e=e());if(e instanceof t.Model){var o=s?s+"_":"",u=n.extend({},e.attributes,e.obs||{});i["$"+(s||"model")]=function(){return r&&r.push([e,"change"]),e},n.each(u,function(t,s){i[o+s]=function(t){return r&&r.push([e,"change:"+s]),n.isUndefined(t)?e.get(s):n.isObject(t)&&!n.isArray(t)?e.set(t):e.set(s,t)}})}else e instanceof t.Collection&&(i["$"+(s||"collection")]=function(){return r&&r.push([e,"reset add remove sort"]),e});return e}function o(e){return n.isFunction(e)?e():(n.isObject(e)&&(e=n.isArray(e)?e.slice():n.clone(e),n.each(e,function(t,n){e[n]=o(t)})),e)}var e=this,t=e.Backbone,n=e._;t.Epoxy=t.Epoxy||{};var r,s=t.Epoxy.View=t.View.extend({constructor:function(e){this._bind=[],t.View.prototype.constructor.apply(this,arguments),this.applyBindings()},bindings:"data-bind",applyBindings:function(){function o(t,n,i){try{e._bind.push(new f(t,n,s,r))}catch(o){throw'Error parsing bindings for "'+i+'" >> '+o}}this.removeBindings();if(!this.model&&!this.collection)return;var e=this,t=this.bindingSources,r=n.clone(u),s={};n.each(e.bindingHandlers||{},function(e,t){r[t]=n.isFunction(e)?{set:e}:e}),e.model=i(e.model,s),e.collection=i(e.collection,s),n.each(t,function(e,n){t[n]=i(e,s,n)});if(n.isObject(this.bindings))n.each(this.bindings,function(e,t){var n=this.$(t);this.$el.is(t)&&(n=n.add(this.$el)),n.length&&o(n,e,t)},this);else{var a=this.bindings,l="["+a+"]",c=this.$(l);this.$el.is(l)&&(c=c.add(this.$el)),c.each(function(e){e=$(this),o(e,e.attr(a),l)})}},removeBindings:function(){while(this._bind.length)this._bind.pop().dispose()},remove:function(){this.removeBindings(),t.View.prototype.remove.call(this)}}),u={attr:{set:function(e,t){e.attr(t)}},checked:{get:function(e,t){var r=!!e.prop("checked"),i=e.val();if(e.is(":radio"))return i;if(n.isArray(t)){t=t.slice();var s=n.indexOf(t,i);return r&&s<0?t.push(i):!r&&s>-1&&t.splice(s,1),t}return r},set:function(e,t){var r=!!t;e.is(":radio")?r=t==e.val():n.isArray(t)&&(r=n.contains(t,e.val())),e.prop("checked",r)}},classes:{set:function(e,t){n.each(t,function(t,n){e.toggleClass(n,!!t)})}},collection:{set:function(e,r,i){var s=t.Collection;if(!(r instanceof s&&n.isFunction(r.view)))throw"Binding 'collection:' requires a Collection with a 'view' constructor.";var o=r.models,u=this.v,a;i=i||r;if(i instanceof t.Model)if(!u.hasOwnProperty(i.cid)){u[i.cid]=a=new r.view({model:i});var f=n.indexOf(o,i);e.children().length<f?e.eq(f).before(a.$el):e.append(a.$el)}else a=u[i.cid],a.remove(),delete u[i.cid];else if(i instanceof s){var l=n.every(o,function(e){return u.hasOwnProperty(e.cid)});e.hide(),l?r.each(function(t){e.append(u[t.cid].$el)}):(this.empty(),r.each(function(t){u[t.cid]=a=new r.view({model:t}),e.append(a.$el)})),e.show()}}},css:{set:function(e,t){e.css(t)}},disabled:{set:function(e,t){e.prop("disabled",!!t)}},enabled:{set:function(e,t){e.prop("disabled",!t)}},html:{set:function(e,t){e.html(t)}},text:{set:function(e,t){e.text(t)}},toggle:{set:function(e,t){e.toggle(!!t)}},value:{get:function(e){return e.val()},set:function(e,t){e.val(t)}}},a={all:function(){var e=arguments;return function(){var t=!0;for(var n=0,r=e.length;n<r;n++)o(e[n])||(t=!1);return t}},any:function(){var e=arguments;return function(){var t=!1;for(var n=0,r=e.length;n<r;n++)o(e[n])&&(t=!0);return t}},none:function(){var e=arguments;return function(){var t=!0;for(var n=0,r=e.length;n<r;n++)o(e[n])&&(t=!1);return t}},not:function(e){return function(){return!o(e)}},format:function(){var e=arguments;return function(){var t=o(e[0]);for(var n=1,r=e.length;n<r;n++)t=t.replace("$"+n,o(e[n]));return t}},select:function(){var e=arguments;return function(){var t=o(e[0]),n=o(e[1]),r=o(e[2]);return t?n:r}}},f=function(e,t,i,s){this.$el=e,this.v={};var u=this,f=e[0].tagName.toLowerCase(),l=f=="input"||f=="select"||f=="textarea",c=new Function("$o","$a","with($o){with($a){return{"+t+"}}}"),h=["change"];t=c(a,i),t.events&&(h=n.isArray(t.events)?n.union(h,t.events):h,delete t.events),this.events=n.map(h,function(e){return e+".epoxy"}).join(" "),n.each(t,function(e,t){if(!s.hasOwnProperty(t))throw"invalid binding => "+t;var i=s[t],a=[];r=a,i.set.call(u,u.$el,o(e)),r=null,l&&i.get&&n.isFunction(e)&&u.$el.on(u.events,function(){e(i.get.call(u,u.$el,o(e)))});if(a.length){var f=function(t){i.set.call(u,u.$el,o(e),t)};for(var c=0,h=a.length;c<h;c++)u.listenTo(a[c][0],a[c][1],f)}})};n.extend(f.prototype,t.Events,{empty:function(){for(var e in this.v)this.v.hasOwnProperty(e)&&(e.remove(),delete this.v[e])},dispose:function(){this.empty(),this.stopListening(),this.$el.off(this.events),this.$el=null}})}.call(this);